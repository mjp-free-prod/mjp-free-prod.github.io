import{_ as E}from"./AppProductsGrid.vue.5a554516.js";import{f as q,r as v,i as K,j as $,o as P,k as S,w as p,q as _,s as H,b as c,n as N,v as Q,g as B,S as W,O as X}from"./entry.9b45c852.js";import{A as k}from"./AppCardGroup.ee93b062.js";import{A as Y}from"./AppCardLayout.3b8704c6.js";import Z from"./order-discussion.fb1ee9c1.js";import{_ as tt}from"./order-form-ro.vue.f5e6e86c.js";import{_ as et}from"./AppOrderPublicStatusForm.vue.5e00b046.js";import{s as at}from"./button.esm.6176fc8e.js";import{A as rt}from"./AppCard.73bfc289.js";import{D as V}from"./datetime.f31b9a37.js";import"./app-grid.vue.50bfba8d.js";import"./inputnumber.esm.960b1be9.js";import"./inputtext.esm.c279c8a9.js";import"./dropdown.esm.d4ef765f.js";import"./index.esm.e8e4ef32.js";import"./index.esm.36162d56.js";import"./overlayeventbus.esm.e7eace53.js";import"./virtualscroller.esm.6c99f57e.js";import"./tristatecheckbox.esm.9d69e4f9.js";import"./checkbox.esm.fee42926.js";import"./overlaypanel.esm.449a756f.js";import"./index.esm.bdabf1ee.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./order-discussion-message.37f18bf0.js";function O(t){if(Number.isFinite(t))return t}function U(t){if(typeof t!="string")return;const r=V.fromFormat(t,"yyyy-MM-dd");if(r.isValid)return r.toJSDate()}function G(t){if(typeof t=="object"&&t instanceof Date){const r=V.fromJSDate(t);if(r.isValid)return r.toFormat("yyyy-MM-dd")}if(typeof t=="string"){const r=V.fromFormat("yyyy-MM-dd",t);if(r.isValid)return r.toFormat("yyyy-MM-dd")}}const ot=q({__name:"AppOrderPrivateStatusForm",props:{id:{},readonly:{type:Boolean},data:{}},emits:["update"],setup(t,{emit:r}){const o=t,m=v(null),a=v(null);K(()=>{a.value={deliveryDate:U(o.data.deliveryDate),shippingDate:U(o.data.shippingDate),notes:o.data.notes,totalPriceNet:O(o.data.totalPriceNet),totalPriceGross:O(o.data.totalPriceGross)},m.value=[{$formkit:"primeInputNumber",name:"totalPriceNet",label:"Итого цена нетто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeInputNumber",name:"totalPriceGross",label:"Итого цена брутто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeCalendar",name:"deliveryDate",label:"Дата доставки",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeCalendar",name:"shippingDate",label:"Дата выдачи",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeTextarea",name:"notes",label:"Заметки",rows:"5",_disabled:o.readonly}]});const e=v(null);function F(){var i;(i=e.value)==null||i.node.submit()}function b(){if(!a.value)return;const{deliveryDate:i,shippingDate:s,notes:g}=a.value;r("update",{deliveryDate:G(i),shippingDate:G(s),notes:g})}return(i,s)=>{const g=$("FormKitSchema"),D=at,w=$("FormKit");return P(),S(rt,{basis:"500px",title:"Учёт заказа #"+o.id},{default:p(()=>[_(m)&&_(a)?(P(),S(w,{key:0,ref_key:"form",ref:e,modelValue:_(a),"onUpdate:modelValue":s[1]||(s[1]=T=>H(a)?a.value=T:null),type:"form",actions:!1,onSubmit:b},{default:p(()=>[c(g,{schema:_(m)},null,8,["schema"]),o.readonly?N("",!0):(P(),S(D,{key:0,label:"Обновить",onClick:s[0]||(s[0]=()=>F())}))]),_:1},8,["modelValue"])):N("",!0)]),_:1},8,["title"])}}}),Tt=q({__name:"all-order-info",setup(t){const m=Q().query.orderId,a=Number(Array.isArray(m)?m[0]:m),e=v(null),F=v(void 0),b=v(null),i=v(null),s=B(W),g=B(X);async function D(){e.value=null,F.value=void 0,b.value=null,i.value=null}async function w(){D();const u=(await g.getAllOrders(a))[0];e.value=u;const{id:n,vatDocumentRequired:d,shippingMethodName:y,comment:l,orderStatusTypeId:h,productsPriceToPay:I,totalPriceToPay:x,shippingPriceToPay:A,deliveryDate:M,shippingDate:C,notes:j,totalPriceNet:J,totalPriceGross:z}=u;F.value={id:n,vatDocumentRequired:d,shippingMethodName:y,comment:l},b.value={orderStatusTypeId:h,productsPriceToPay:I,totalPriceToPay:x,shippingPriceToPay:A},i.value={deliveryDate:M,shippingDate:C,notes:j,totalPriceNet:J,totalPriceGross:z}}K(w);async function T(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d}=e.value,{orderStatusTypeId:y,shippingPriceToPay:l}=f;D(),await s.set(async h=>h.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:{shippingPriceToPay:l},newProductsPublicStatus:d.productsPublicStatus,newPrivateStatus:n.privateStatus,newProductsPrivateStatus:n.productsPrivateStatus})),await w()}async function L(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d,orderStatusTypeId:y}=e.value;D(),await s.set(async l=>l.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:d.publicStatus,newProductsPublicStatus:d.productsPublicStatus,newPrivateStatus:f,newProductsPrivateStatus:n.productsPrivateStatus})),await w()}async function R(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d,orderStatusTypeId:y}=e.value,l=[],h=[];for(const I of f){const{priceToPay:x,priceGross:A,priceMarkup:M,priceNet:C}=I;l.push({priceToPay:x}),h.push({priceGross:A,priceMarkup:M,priceNet:C})}D(),await s.set(async I=>I.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:d.publicStatus,newProductsPublicStatus:l,newPrivateStatus:n.privateStatus,newProductsPrivateStatus:h})),await w()}return(f,u)=>{const n=E;return P(),S(Y,null,{default:p(()=>[c(k,null,{default:p(()=>[e.value?(P(),S(n,{key:0,items:e.value.products,mode:"moder",onUpdated:R},null,8,["items"])):N("",!0)]),_:1}),c(k,null,{default:p(()=>[c(tt,{data:F.value},null,8,["data"])]),_:1}),c(k,null,{default:p(()=>[b.value?(P(),S(et,{key:0,id:_(a),data:b.value,readonly:!1,onUpdate:T},null,8,["id","data"])):N("",!0)]),_:1}),c(k,null,{default:p(()=>[i.value?(P(),S(ot,{key:0,id:_(a),data:i.value,readonly:!1,onUpdate:L},null,8,["id","data"])):N("",!0)]),_:1}),c(k,null,{default:p(()=>[c(Z,{"order-id":_(a),mode:"moder"},null,8,["order-id"])]),_:1})]),_:1})}}});export{Tt as default};
